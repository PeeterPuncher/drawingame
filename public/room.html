<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat Room</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container">
    <h1>Chat Room</h1>
    <p id="room-info"></p>
    <div id="messages" class="border p-3 mb-3" style="height: 300px; overflow-y: scroll;"></div>
    <input type="text" id="message-input" class="form-control mb-2" placeholder="Type a message...">
    <button class="btn btn-primary" id="send-button">Send</button>
    <button class="btn btn-secondary" onclick="goBack()">Leave Room</button>
  </div>

  <script>
    const messagesDiv = document.getElementById('messages');
    const nameInput = document.getElementById('name-input');
    const messageInput = document.getElementById('message-input');
    const sendButton = document.getElementById('send-button');
    const roomInfo = document.getElementById('room-info');

    const urlParams = new URLSearchParams(window.location.search);
    const roomId = urlParams.get('roomId');
    roomInfo.innerText = `You are in Room: ${roomId}`;

    let username = "";


    let socket = new WebSocket('wss://multiplayergameprojectthingycouldntcomeu.onrender.com');

    socket.onopen = () =>
    {
      console.log('WebSocket connected');
    };

    // Receive message ////////////////////////////////////////////////////////////////
    socket.onmessage = (event) =>
    {
      const data = JSON.parse(event.data);

      if (data.type == 'message')
      {
        console.log(data);
        const message = document.createElement('div');
        message.innerHTML = `<strong>${data.user}</strong>: ${data.text}`;
        messagesDiv.appendChild(message);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }
      else if(data.type == "joined-room")
      {
        if (username == "")
        {
          username = sessionStorage.getItem('username');
          console.log(`Joined as ${username}`);
          
        }

        console.log(data);
        const message = document.createElement('div');
        message.innerHTML = `<strong>${data.user}</strong> joined the room`;
        messagesDiv.appendChild(message);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
        
      }
    };

    // Send message //////////////////////////////////////////////////////////////////
    sendButton.addEventListener('click', () => 
    {
      if (username == "")
      {
        return;
      }
        socket.send(JSON.stringify({
          type: 'message',
          user: username,
          text: messageInput.value
        }));
    });

    // Leave room ////////////////////////////////////////////////////////////////////
    function goBack()
    {
      window.location.href = "/";
    }

    socket.onclose = () => 
    {
      console.log('WebSocket closed');
    };




    

socket.onerror = (error) => {
  console.error('WebSocket error:', error);
};
  </script>
</body>
</html>