<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas to PNG</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        canvas {
            border: 1px solid black;
            margin: 20px;
        }
        button {
            padding: 10px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="row text-center">

        <div class="col-3 mt-5 text-end">
            <div class="colorButton" data-color="#000000" style="background-color: #000000; height: 40px; width: 40px; display: inline-block;"></div>
            <div class="colorButton" data-color="#FF0000" style="background-color: #FF0000; height: 40px; width: 40px; display: inline-block;"></div>
            <div class="colorButton" data-color="#1100ff" style="background-color: #1100ff; height: 40px; width: 40px; display: inline-block;"></div>
        </div>

        <div class="col-6">
            <canvas id="myCanvas" width="900" height="900" style="border:1px solid #000;"></canvas>
        </div>

        <div class="col-3 text-start mt-3">
            <button class="sizeButton" data-size="5">Vékony</button>
            <button class="sizeButton" data-size="20">Vastag</button>
            <button id="canvasClear" style="background-color: red;">Törlés</button>
            <button id="saveButton" style="background-color: aqua;" onclick="canvasClear()">Mentés</button>
        </div>
    </div>


<script>
   let socket = new WebSocket('wss://multiplayergameprojectthingycouldntcomeu.onrender.com');
socket.onopen = () =>
{
    console.log('WebSocket connection established');
};

const canvas = document.getElementById('myCanvas');
const ctx = canvas.getContext('2d');
const colorButtons = document.querySelectorAll('.colorButton');
const sizeButtons = document.querySelectorAll('.sizeButton');

let isDrawing = false;
let lastX = null;
let lastY = null;
let currentColor = "#000000";
let currentSize = 5;

// Set white background for the canvas
ctx.fillStyle = 'white';
ctx.fillRect(0, 0, canvas.width, canvas.height);
ctx.strokeStyle = currentColor;
ctx.lineWidth = currentSize;

canvas.addEventListener('mousedown', (e) => {
    isDrawing = true;
    lastX = e.offsetX;
    lastY = e.offsetY;
    
    // Draw a single dot when clicking
    let radius = currentSize / 2;
    ctx.beginPath();
    ctx.arc(lastX, lastY, radius, 0, Math.PI * 2);
    ctx.fillStyle = currentColor;
    ctx.fill();
    ctx.closePath();
});

canvas.addEventListener('mousemove', (e) => {
    if (!isDrawing) return;
    
    let x = e.offsetX;
    let y = e.offsetY;
    let radius = currentSize / 2;
    let distance = Math.hypot(x - lastX, y - lastY);
    let step = radius / 2;
    
    for (let i = 0; i < distance; i += step) {
        let progress = i / distance;
        let drawX = lastX + (x - lastX) * progress;
        let drawY = lastY + (y - lastY) * progress;
        
        ctx.beginPath();
        ctx.arc(drawX, drawY, radius, 0, Math.PI * 2);
        ctx.fillStyle = currentColor;
        ctx.fill();
        ctx.closePath();
    }
    
    lastX = x;
    lastY = y;
});

canvas.addEventListener('mouseup', () => {
    isDrawing = false;
    lastX = null;
    lastY = null;
});

canvas.addEventListener('mouseout', () => {
    isDrawing = false;
    lastX = null;
    lastY = null;
});

colorButtons.forEach(button => {
    button.addEventListener('click', () => {
        currentColor = button.getAttribute('data-color');
    });
});

sizeButtons.forEach(button => {
    button.addEventListener('click', () => {
        currentSize = parseInt(button.getAttribute('data-size'));
    });
});

function canvasClear()
{
    ctx.fillStyle = 'white';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.strokeStyle = currentColor;
    ctx.lineWidth = currentSize;
}

// Mentés gomb eseménykezelője
document.getElementById('saveButton').addEventListener('click', function() {
    // A canvas képe PNG formátumban
    const imageData = canvas.toDataURL('image/png');

    socket.send(JSON.stringify({
        type: 'save-drawing',
        imageFile: imageData
    }));
});

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
